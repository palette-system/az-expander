# az-expander(キースキャンに特化したIOエキスパンダ)

## 基本仕様
|  内容  |  説明  |
|  --  |  --  |
|  MCU  |  ATTiny826  |
|  動作電圧  |  1.8V ～ 5.5V  |
|  接続方法  |  I2C  |
|  I2Cアドレス  |  0x30 (コマンドにより変更可能)  |
|  I/O数  |  16  |

<br><br>

## コマンド

### 0x01　コンフィグの設定

<b>■ 送信 ： 19 byte </b>
|  内容  |  説明  |  サイズ(byte)  |
|  --  |  --  |  --  |
|  コマンドタイプ  |  0x01 (固定)  |  1  |
|  変更後のI2Cアドレス  |  接続先のアドレスを変更できます  |  1  |
|  マトリックススキャンのタイプ  |  0 = 通常マトリックス<br>1 = 倍マトリックス  |  1  |
|  各ピンのタイプ  |  1バイト1ピンで16ピン分のI/Oを設定します<br><br>0 = 未使用<br>1 = ダイレクトインプット<br>2 = COL インプット<br>3 = ROW インプット<br>4 = ロータリーエンコーダA<br>5 = ロータリーエンコーダB<br>6 = ロータリーエンコーダC<br>7 = ロータリーエンコーダD<br>8 = ロータリーエンコーダE<br>9 = ロータリーエンコーダF<br>10 = ロータリーエンコーダG<br>11 = ロータリーエンコーダH  |  16  |

<b>■ レスポンス ： 2 byte </b>
|  内容  |  説明  |  サイズ(byte)  |
|  --  |  --  |  --  |
|  ステータス  |  1 = 変更なし<br>2 = 変更あり  |  1  |
|  変更後のI2Cアドレス  |  　  |  1  |

<br><br>

### 0x02　現在のコンフィグ取得

<b>■ 送信 ： 1 byte </b>
|  内容  |  説明  |  サイズ(byte)  |
|  --  |  --  |  --  |
|  コマンドタイプ  |  0x02 (固定)  |  1  |

<b>■ レスポンス ： 18 byte </b>
|  内容  |  説明  |  サイズ(byte)  |
|  --  |  --  |  --  |
|  変更後のI2Cアドレス  |  接続先のアドレスを変更できます  |  1  |
|  マトリックススキャンのタイプ  |  0 = 通常マトリックス<br>1 = 倍マトリックス  |  1  |
|  各ピンのタイプ  |  1バイト1ピンで16ピン分のI/Oを設定<br><br>※ 詳細はコンフィグの設定コマンド参照  |  16  |

<br><br>

### 0x03　現在の読み込むキーの数とバイト数を取得

<b>■ 送信 ： 1 byte </b>
|  内容  |  説明  |  サイズ(byte)  |
|  --  |  --  |  --  |
|  コマンドタイプ  |  0x03 (固定)  |  1  |

<b>■ レスポンス ： 2 byte </b>
|  内容  |  説明  |  サイズ(byte)  |
|  --  |  --  |  --  |
|  読み込むキーの数  |  0 ～ 128  |  1  |
|  レスポンスのバイト数  |  0 ～ 16  |  1  |

<br><br>

### 0x04　現在のスキャンデータを受け取る

<b>■ 送信 ： 1 byte </b>
|  内容  |  説明  |  サイズ(byte)  |
|  --  |  --  |  --  |
|  コマンドタイプ  |  0x04 (固定)  |  1  |

<b>■ レスポンス ： 0 ～ 16 byte </b>
|  内容  |  説明  |  サイズ(byte)  |
|  --  |  --  |  --  |
|  スキャンした結果  |  1キー1bitでコンフィグで設定されているキー分データを返します<br><br>0 = OFF<br>1 = ON  |  0 ～ 16  |

<br><br>

## ボード設定
<img src="/images/board.png" width="500"><br>
